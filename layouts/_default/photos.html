{{ define "main" }}
<div class="post">
  <h2 class="post-title">{{ .Title }}</h2>
</div>

<div class="page-photos">
  {{ $photoDirs := readDir "./static/photos" }} <!-- 读取 photos 目录中的所有文件夹 -->

  {{ $sortedDirs := slice }} <!-- 初始化空切片存储排序后的目录 -->
  {{ range $photoDirs }}
    {{ if .IsDir }} <!-- 仅保留文件夹（排除单个文件） -->
      {{ $sortedDirs = $sortedDirs | append . }}
    {{ end }}
  {{ end }}

  <!-- 按文件夹名称倒序排序（如日期目录 2024-05 在前） -->
  {{ $sortedDirs = sort $sortedDirs "Name" "desc" }}

  {{ range $sortedDirs }}
    {{ $dirName := .Name }} <!-- 当前文件夹名称（如 "2024-05-旅行"） -->
    <div class="photo-group">
      <h3 class="group-title">{{ $dirName }}</h3> <!-- 显示照片组标题 -->

      <div class="group-photos">
        {{ $photos := readDir (printf "./static/photos/%s" $dirName) }} <!-- 读取当前文件夹下的图片 -->
        {{ range $photos }}
          <figure>
            <!-- 关键修正：printf 中变量用空格分隔，确保 URL 拼接完整 -->
            <a data-fancybox="gallery" 
               href="{{ printf "https://jsd-proxy.ygxz.in/gh/iosxx/blogs@latest/static/photos/%s/%s" $dirName .Name }}" 
               data-caption="{{ .Name }}">
              <img src="{{ printf "https://jsd-proxy.ygxz.in/gh/iosxx/blogs@latest/static/photos/%s/%s" $dirName .Name }}" 
                   alt="{{ .Name }}" />
            </a>
            <!-- <figcaption>{{ .Name | replaceRE "(.*)[.].*" "$1" }}</figcaption> -->
          </figure>
        {{ end }}
      </div>
    </div>
  {{ end }}
</div>
{{ end }}
